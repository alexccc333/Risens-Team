(function(){var lastTime=0;var vendors=["ms","moz","webkit","o"];for(var x=0;x<vendors.length&&!window.requestAnimationFrame;++x){window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){console.log("Use fallback for requestAnimationFrame");window.requestAnimationFrame=function(callback,element){var currTime=(new Date).getTime();var timeToCall=Math.max(0,16-(currTime-lastTime));var id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);lastTime=currTime+timeToCall;return id}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(id){clearTimeout(id)}}})();function subtitlesPlugin(options,arg){var player=this;var debugMode=false;var SimpleMap=function(){function SimpleMap(iterable){this.clear();if(iterable===undefined){return}if(!Array.isArray(iterable)){throw new Error("Non-array iterables are not supported by the SimpleMap constructor.")}for(var _i=0;_i<iterable.length;_i++){var element=iterable[_i];this.set(element[0],element[1])}}SimpleMap.prototype.get=function(key){var property=this._keyToProperty(key);if(property===null){return undefined}return this._values[property]};SimpleMap.prototype.has=function(key){var property=this._keyToProperty(key);if(property===null){return false}return property in this._keys};SimpleMap.prototype.set=function(key,value){var property=this._keyToProperty(key);if(property===null){throw new Error("This Map implementation only supports Number and String keys, or keys with an id property.")}if(!(property in this._keys)){this._size++}this._keys[property]=key;this._values[property]=value;return this};SimpleMap.prototype.delete=function(key){var property=this._keyToProperty(key);if(property===null){return false}var result=property in this._keys;if(result){delete this._keys[property];delete this._values[property];this._size--}return result};SimpleMap.prototype.clear=function(){this._keys=Object.create(null);this._values=Object.create(null);this._size=0};SimpleMap.prototype.forEach=function(callbackfn,thisArg){for(var _i=0,_a=Object.keys(this._keys);_i<_a.length;_i++){var property=_a[_i];callbackfn.call(thisArg,this._values[property],this._keys[property],this)}};Object.defineProperty(SimpleMap.prototype,"size",{get:function(){return this._size},enumerable:true,configurable:true});SimpleMap.prototype._keyToProperty=function(key){if(typeof key==="number"){return"#"+key}if(typeof key==="string"){return"'"+key}if(key.id!==undefined){return"!"+key.id}return null};return SimpleMap}();if(Map===undefined||typeof Map.prototype.forEach!=="function"||function(){try{return new Map([[1,"foo"],[2,"bar"]]).size!==2}catch(ex){return true}}()){if(Map===undefined){var Map}Map=SimpleMap}function mixin(clazz,mixins){for(var _i=0;_i<mixins.length;_i++){var mixin_1=mixins[_i];for(var _a=0,_b=Object.getOwnPropertyNames(mixin_1.prototype);_a<_b.length;_a++){var name_1=_b[_a];clazz.prototype[name_1]=mixin_1.prototype[name_1]}}}var ClockEvent={};ClockEvent[ClockEvent["Play"]=0]="Play";ClockEvent[ClockEvent["Tick"]=1]="Tick";ClockEvent[ClockEvent["Pause"]=2]="Pause";ClockEvent[ClockEvent["Stop"]=3]="Stop";ClockEvent[ClockEvent["RateChange"]=4]="RateChange";var EventSource=function(){function EventSource(){}EventSource.prototype.addEventListener=function(type,listener){var listeners=this._eventListeners.get(type);if(listeners===undefined){this._eventListeners.set(type,listeners=[])}listeners.push(listener)};EventSource.prototype._dispatchEvent=function(type,args){var listeners=this._eventListeners.get(type);if(listeners!==undefined){for(var _i=0;_i<listeners.length;_i++){var listener=listeners[_i];listener.apply(this,args)}}};return EventSource}();var ManualClock=function(){function ManualClock(){this._currentTime=-1;this._rate=1;this._enabled=true;this._paused=true;this._eventListeners=new Map}ManualClock.prototype.play=function(){if(!this._enabled){return}if(!this._paused){return}this._paused=false;this._dispatchEvent(ClockEvent.Play,[])};ManualClock.prototype.tick=function(currentTime){if(!this._enabled){return}if(this._currentTime===currentTime){return}this.play();this._currentTime=currentTime;this._dispatchEvent(ClockEvent.Tick,[])};ManualClock.prototype.seek=function(time){if(!this._enabled){return}this.pause();if(this._currentTime===time){return}this.stop();this.tick(time);this.pause()};ManualClock.prototype.pause=function(){if(!this._enabled){return}if(this._paused){return}this._paused=true;this._dispatchEvent(ClockEvent.Pause,[])};ManualClock.prototype.stop=function(){this._dispatchEvent(ClockEvent.Stop,[])};Object.defineProperty(ManualClock.prototype,"currentTime",{get:function(){return this._currentTime},enumerable:true,configurable:true});Object.defineProperty(ManualClock.prototype,"enabled",{get:function(){return this._enabled},enumerable:true,configurable:true});Object.defineProperty(ManualClock.prototype,"paused",{get:function(){return this._paused},enumerable:true,configurable:true});Object.defineProperty(ManualClock.prototype,"rate",{get:function(){return this._rate},enumerable:true,configurable:true});ManualClock.prototype.setRate=function(rate){if(this._rate===rate){return}this._rate=rate;this._dispatchEvent(ClockEvent.RateChange,[])};ManualClock.prototype.enable=function(){if(this._enabled){return false}this._enabled=true;return true};ManualClock.prototype.disable=function(){if(!this._enabled){return false}this.pause();this.stop();this._enabled=false;return true};ManualClock.prototype.toggle=function(){if(this._enabled){this.disable()}else{this.enable()}};ManualClock.prototype.setEnabled=function(enabled){if(enabled){return this.enable()}else{return this.disable()}};return ManualClock}();mixin(ManualClock,[EventSource]);var AutoClock=function(){function AutoClock(getCurrentTime,autoPauseAfter){this._getCurrentTime=getCurrentTime;this._autoPauseAfter=autoPauseAfter;this._manualClock=new ManualClock;this._nextAnimationFrameRequestId=null;this._lastKnownExternalTime=null;this._lastKnownExternalTimeObtainedAt=null}AutoClock.prototype.play=function(){if(!this._manualClock.enabled){return}this._startTicking();this._manualClock.play()};AutoClock.prototype.pause=function(){if(!this._manualClock.enabled){return}if(this._nextAnimationFrameRequestId===null){if(debugMode){console.warn("AutoClock.pause: Abnormal state detected. AutoClock._nextAnimationFrameRequestId should not have been null.")}return}this._stopTicking();this._manualClock.pause()};AutoClock.prototype.seeking=function(){this._manualClock.seek(this._getCurrentTime())};Object.defineProperty(AutoClock.prototype,"currentTime",{get:function(){return this._manualClock.currentTime},enumerable:true,configurable:true});Object.defineProperty(AutoClock.prototype,"enabled",{get:function(){return this._manualClock.enabled},enumerable:true,configurable:true});Object.defineProperty(AutoClock.prototype,"paused",{get:function(){return this._manualClock.paused},enumerable:true,configurable:true});Object.defineProperty(AutoClock.prototype,"rate",{get:function(){return this._manualClock.rate},enumerable:true,configurable:true});AutoClock.prototype.setRate=function(rate){this._manualClock.setRate(rate)};AutoClock.prototype.enable=function(){if(!this._manualClock.enable()){return false}this._startTicking();return true};AutoClock.prototype.disable=function(){if(!this._manualClock.disable()){return false}this._stopTicking();return true};AutoClock.prototype.toggle=function(){this._manualClock.toggle()};AutoClock.prototype.setEnabled=function(enabled){return this._manualClock.setEnabled(enabled)};AutoClock.prototype.addEventListener=function(type,listener){this._manualClock.addEventListener(type,listener)};AutoClock.prototype._onTimerTick=function(timeStamp){var _this=this;if(!this._manualClock.enabled){if(debugMode){console.warn("AutoClock._onTimerTick: Called when disabled.")}return}var currentTime=this._manualClock.currentTime;var currentExternalTime=this._getCurrentTime();if(!this._manualClock.paused){if(this._lastKnownExternalTime!==null&&currentExternalTime===this._lastKnownExternalTime){if(timeStamp-this._lastKnownExternalTimeObtainedAt>this._autoPauseAfter){this._lastKnownExternalTimeObtainedAt=null;this._manualClock.pause()}else{this._manualClock.tick((timeStamp-this._lastKnownExternalTimeObtainedAt)/1e3*this._manualClock.rate+this._lastKnownExternalTime)}}else{this._lastKnownExternalTime=currentExternalTime;this._lastKnownExternalTimeObtainedAt=timeStamp;this._manualClock.tick(currentExternalTime)}}else{if(currentTime!==currentExternalTime){this._lastKnownExternalTime=currentExternalTime;this._lastKnownExternalTimeObtainedAt=timeStamp;this._manualClock.tick(currentExternalTime)}}this._nextAnimationFrameRequestId=requestAnimationFrame(function(timeStamp){return _this._onTimerTick(timeStamp)})};AutoClock.prototype._startTicking=function(){var _this=this;if(this._nextAnimationFrameRequestId===null){this._nextAnimationFrameRequestId=requestAnimationFrame(function(timeStamp){return _this._onTimerTick(timeStamp)})}};AutoClock.prototype._stopTicking=function(){if(this._nextAnimationFrameRequestId!==null){cancelAnimationFrame(this._nextAnimationFrameRequestId);this._nextAnimationFrameRequestId=null}};return AutoClock}();var VideoClock=function(){function VideoClock(video){var _this=this;_this._autoClock=new AutoClock(function(){return video.currentTime()},100);video.on("playing",function(){return _this._autoClock.play()},false);video.on("pause",function(){return _this._autoClock.pause()},false);video.on("seeking",function(){return _this._autoClock.seeking()},false);video.on("ratechange",function(){return _this._autoClock.setRate(video.playbackRate())},false)}Object.defineProperty(VideoClock.prototype,"currentTime",{get:function(){return this._autoClock.currentTime},enumerable:true,configurable:true});Object.defineProperty(VideoClock.prototype,"enabled",{get:function(){return this._autoClock.enabled},enumerable:true,configurable:true});Object.defineProperty(VideoClock.prototype,"paused",{get:function(){return this._autoClock.paused},enumerable:true,configurable:true});Object.defineProperty(VideoClock.prototype,"rate",{get:function(){return this._autoClock.rate},enumerable:true,configurable:true});VideoClock.prototype.enable=function(){return this._autoClock.enable()};VideoClock.prototype.disable=function(){return this._autoClock.disable()};VideoClock.prototype.toggle=function(){this._autoClock.toggle()};VideoClock.prototype.setEnabled=function(enabled){return this._autoClock.setEnabled(enabled)};VideoClock.prototype.addEventListener=function(type,listener){this._autoClock.addEventListener(type,listener)};return VideoClock}();player.subtitles=player.subtitles||{};player.subtitles.libassJsIsReady=false;if(player.tag==null){player.tag=player.tech.el_}player.subtitles.init=function(options,arg){if(player.tag==null){return}var track=player.el_.getAttribute("data-subtitles");if(track){console.log("Init ASS track: "+track);player.subtitles.canvas=document.createElement("canvas");player.subtitles.canvas.id="subtitles-canvas";player.subtitles.canvas.className="libassjs-canvas";var div=document.createElement("div");div.className="libassjs-canvas-p";div.appendChild(player.subtitles.canvas);player.tag.parentNode.insertBefore(div,player.tag.nextSibling);player.subtitles.videoClock=new VideoClock(player);var fonts=JSON.parse(player.el_.getAttribute("data-fonts"));var LibassJsLoaded=function(){player.subtitles.libassjs=new LibassJs(player.subtitles.canvas,track,fonts,player.subtitles.libassJsReady)};if(window.LibassJs){LibassJsLoaded()}else if(!window.LibassJsLoaded){window.LibassJsLoaded=LibassJsLoaded}}};player.subtitles.initTrack=function(options,arg){var track=player.el_.getAttribute("data-vtt");if(track){console.log("Init vtt track: "+track);player.subtitles.trackUrl=track;player.subtitles.initTrackInternal();player.on("durationchange",function(){player.subtitles.initTrackInternal()})}};player.subtitles.dispose=function(){if(player.subtitles.videoClock)player.subtitles.videoClock.disable();delete player.subtitles.videoClock;if(player.subtitles.canvas)player.subtitles.canvas.parentNode.remove();delete player.subtitles.canvas;if(typeof player.subtitles.libassjs=="object"){delete player.subtitles.libassjs}player.subtitles.libassJsIsReady=false};player.subtitles.initTrackInternal=function(){player.subtitles.timeOffset=player.el().timeOffset||0;if(player.subtitles.track){player.removeRemoteTextTrack(player.textTracks()[0])}player.subtitles.track=player.addRemoteTextTrack({kind:"captions",src:player.subtitles.trackUrl+"?timeOffset="+player.subtitles.timeOffset,srclang:"ru",default:"default",label:"Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ"});player.textTracks()[0].mode="showing"};player.displayedSize=function(){var originalWidth=player.tag.videoWidth;var originalHeight=player.tag.videoHeight;var ratio=originalWidth/originalHeight;var tagWidth=player.tag.offsetWidth;var tagHeight=player.tag.offsetHeight;var realWidth,realHeight;if(isNaN(ratio)){ratio=16/9}if(tagWidth/ratio>tagHeight){realWidth=tagHeight*ratio;realHeight=tagHeight}else{realWidth=tagWidth;realHeight=tagWidth/ratio}return{width:Math.floor(realWidth),height:Math.floor(realHeight)}};player.subtitles.libassJsReady=function(){player.subtitles.libassJsIsReady=true;var size=player.displayedSize();player.subtitles.libassjs.init(size.width,size.height);player.subtitles.videoClock.addEventListener(ClockEvent.Play,player.subtitles.render);player.subtitles.videoClock.addEventListener(ClockEvent.Tick,player.subtitles.render);player.subtitles.videoClock.addEventListener(ClockEvent.Pause,player.subtitles.render);player.subtitles.videoClock.addEventListener(ClockEvent.Stop,player.subtitles.render);player.subtitles.videoClock.addEventListener(ClockEvent.RateChange,player.subtitles.render);player.one("loadedmetadata",player.subtitles.resize)};player.subtitles.resize=function(){if(player.subtitles.libassJsIsReady){var size=player.displayedSize();player.subtitles.libassjs.resize(size.width,size.height);player.subtitles.render()}};var fpsCounter={startTime:0,frameNumber:0,getFPS:function(){this.frameNumber++;var d=(new Date).getTime(),currentTime=(d-this.startTime)/1e3,result=Math.floor(this.frameNumber/currentTime);if(currentTime>1){this.startTime=(new Date).getTime();this.frameNumber=0}return result}};var fps=30;var now;var then=Date.now();var interval=1e3/fps;var intervalRender=1/30*2;var delta;player.subtitles.render=function(){now=Date.now();delta=now-then;if(delta>interval||this._paused){then=now-delta%interval;player.subtitles.libassjs.render(player.subtitles.videoClock.currentTime+intervalRender)}};player.subtitles.isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);if(player.subtitles.isMobile){player.subtitles.initTrack(options,arg)}else{player.subtitles.init(options,arg)}player.on("dispose",player.subtitles.dispose);return player}videojs.plugin("subtitlesPlugin",subtitlesPlugin);